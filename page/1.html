<!DOCTYPE html> <html lang="en" itemscope itemType="http://schema.org/Blog"> <head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website# type: http://ogp.me/ns/profile#"> <meta charset="utf-8"> <title itemprop="name">Moez Bouhlel [lejenome] Website</title> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <meta name="description" content="Moez Bouhlel (lejenome) website for latest updates. Hire me for a part-time job or for an internship at https://lejenome.github.io/resume"> <meta name="keywords" content="php,github,webhook,django,linux,qemu,kvm,windows,javascript,slack,mtcfss,note,linux,qemu,kvm,windows,moez,bouhlel,lejenome,bmoez,bmoezj,bmoez.j" itemprop="keywords"> <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no,width=device-width,minimum-scale=1"> <meta name="author" content="Moez Bouhlel" itemprop="creator"> <meta name="copyright" content="Moez Bouhlel 2016, All Rights Reserved."> <link rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"> <base href="/"> <link rel="alternate" type="application/rss+xml" href="rss.xml"> <meta name="google-site-verification" content="S6sLGAfoubJHu5uLGJMU9sOD82LL7APn_EYSZQPOXsE"> <meta name="flattr:id" content="wlwnr0"> <link rel="openid.server" href="https://login.launchpad.net/+openid"> <link rel="openid.delegate" href="https://login.launchpad.net/+id/mBmWsYt"> <link rel="openid2.provider" href="https://login.launchpad.net/+openid"> <link rel="openid2.local_id" href="https://login.launchpad.net/+id/mBmWsYt"> <meta http-equiv="X-XRDS-Location" content="https://login.launchpad.net/+id/mBmWsYt/+xrds"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@lejenome"> <meta name="twitter:creator" content="@lejenome"> <meta name="twitter:domain" content="lejenome.github.io"> <meta property="og:site_name" content="Moez Bouhlel"> <meta property="og:type" content="article"> <meta itemprop="inLanguage" content="en"> <meta property="og:url" itemprop="url" content="https://lejenome.github.io/page/1"> <meta name="twitter:description" property="og:description" itemprop="description" content="Moez Bouhlel (lejenome) Website for latest updates."> <meta name="twitter:title" property="og:title" content="Moez Bouhlel [lejenome] Website"> <meta name="twitter:image" property="og:image" itemprop="image" content="https://lejenome.github.io/logo.png"> <link rel="apple-touch-icon-precomposed" sizes="57x57" href="imgs/favicon/apple-touch-icon-57x57.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="imgs/favicon/apple-touch-icon-114x114.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="imgs/favicon/apple-touch-icon-72x72.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="imgs/favicon/apple-touch-icon-144x144.png"> <link rel="apple-touch-icon-precomposed" sizes="60x60" href="imgs/favicon/apple-touch-icon-60x60.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="imgs/favicon/apple-touch-icon-120x120.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="imgs/favicon/apple-touch-icon-76x76.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="imgs/favicon/apple-touch-icon-152x152.png"> <link rel="icon" type="image/png" href="imgs/favicon/favicon-196x196.png" sizes="196x196"> <link rel="icon" type="image/png" href="imgs/favicon/favicon-96x96.png" sizes="96x96"> <link rel="icon" type="image/png" href="imgs/favicon/favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="imgs/favicon/favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="imgs/favicon/favicon-128.png" sizes="128x128"> <meta name="msapplication-TileImage" content="imgs/favicon/mstile-144x144.png"> <meta name="msapplication-square70x70logo" content="imgs/favicon/mstile-70x70.png"> <meta name="msapplication-square150x150logo" content="imgs/favicon/mstile-150x150.png"> <meta name="msapplication-wide310x150logo" content="imgs/favicon/mstile-310x150.png"> <meta name="msapplication-square310x310logo" content="imgs/favicon/mstile-310x310.png"> <link href="css/style.css" type="text/css" rel="stylesheet"> <script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src="https://www.google-analytics.com/analytics.js",s.parentNode.insertBefore(o,s)}(window,document,"script",0,"ga"),ga("create","UA-28759938-2","auto"),ga("_trackPageLoadTime"),ga("send","pageview")</script> </head> <body class="container"> <header> <h1><a href="">Moez Bouhlel <small>@lejenome</small></a></h1> <nav> <ul class="menu"> <li><a href="">Home</a></li> <li><a href="https://twitter.com/lejenome">Twitter</a></li> <li><a href="https://github.com/lejenome">GitHub</a></li> <li><a href="https://www.linkedin.com/in/lejenome">LinkedIn</a></li> <li><a href="resume" rel="author">Resume</a></li> <li><a href="contact">Contact</a></li> </ul> <ul class="icons"> <li><a rel="archives" title="Archive" href="archive"><i class="fa fa-folder-open"></i></a></li> <li><a title="RSS" rel="alternate" type="application/rss+xml" href="rss.xml"><i class="fa fa-rss"></i></a></li> </ul> </nav> </header> <div> <section id="articales" class="type-page"> <article class="post" id="github-push-webhook-implementation" itemscope itemType="http://schema.org/TechArticle" itemid="https://lejenome.github.io/post/github-push-webhook-implementation"> <meta itemprop="proficiencyLevel" content="Beginner"> <link itemprop="publisher" href="https://lejenome.github.io/resume" rel="author"> <hgroup> <h2 class="post-title" itemprop="name" itemprop="headline"><a href="post/github-push-webhook-implementation" class="post-link" itemprop="url">Github push webhook implementation</a></h2> <h3 class="post-date"> <time datetime="2017/07/30" itemprop="datePublished">Sun Jul 30 2017</time> - <a href="https://github.com/lejenome/lejenome.github.io/blob/master/posts/github-webhook.rst" rel="edit"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> edit</a> </h3> </hgroup> <div class="post-body" itemprop="articleBody"> <p>Github and Bitbuket provide webhooks support to notify external services when certain events happen with a repository. The most commonly used webhook event is <tt class="docutils literal">push</tt>.</p> <p>The following code is a PHP implementation of GitHub webhook that will update a repository clone and execute required deployment code when a new commit was pushed.</p> <script src="https://gist.github.com/lejenome/2ee7f1f47b9800140c57b51c1474439f.js"></script><p>After adding this file to your server, you need to make the following changes before adding the webhook to github:</p> <ul class="simple"> <li>Sett <tt class="docutils literal">SECRET_TOKEN</tt> to a randomly generated token. You can use this command to generate a truly random secure token on Linux:</li> </ul> <pre class="code shell literal-block">
head /dev/urandom <span class="p">|</span> tr -dc A-Za-z0-9 <span class="p">|</span> head -c <span class="m">40</span>
</pre> <ul class="simple"> <li>Change <tt class="docutils literal">$commands</tt> list to matches your need for every repository. An example of updating both a static website repository and a Django based application repository is provided on the code above as a reference.</li> <li>Add write access to the process running PHP (FastCGI, mod_php, ...) which is mostly either running within the group <tt class="docutils literal"><span class="pre">www-data</span></tt> or <tt class="docutils literal">www</tt> depending on the Linux distribution running on your server.</li> <li>If your repository is private, generate a ssh key and add the pubkey as a read-only deployment key to your repository settings. This key should be generated using the same user as the PHP process.</li> </ul> <p>Finally, add a webhook to your repository settings. Make sure to set the content type to <tt class="docutils literal">application/json</tt> and the secret to the secret token you have already generated.</p> </div> </article><article class="post" id="boot-physical-windows-inside-qemu-guest-machine" itemscope itemType="http://schema.org/TechArticle" itemid="https://lejenome.github.io/post/boot-physical-windows-inside-qemu-guest-machine"> <meta itemprop="proficiencyLevel" content="Beginner"> <link itemprop="publisher" href="https://lejenome.github.io/resume" rel="author"> <hgroup> <h2 class="post-title" itemprop="name" itemprop="headline"><a href="post/boot-physical-windows-inside-qemu-guest-machine" class="post-link" itemprop="url">Boot physical Windows inside Qemu guest machine</a></h2> <h3 class="post-date"> <time datetime="2017/02/14" itemprop="datePublished">Tue Feb 14 2017</time> - <a href="https://github.com/lejenome/lejenome.github.io/blob/master/posts/boot-physical-windows-inside-qemu.rst" rel="edit"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> edit</a> </h3> </hgroup> <div class="post-body" itemprop="articleBody"> <p>Recently, I needed to setup a new Windows system for use in an Internship project. Like the old setup which was described on an <a class="reference external" href="/post/dualboolt-guest-window-machine">older post</a>, I needed to have access to the same Windows from inside Qemu and from dual-boot for performance reseasons. But instead of requiring to install Windows two times (once directly on PC as host and the other inside Qemu) which caused some issues including slow filesystem operations when booting as host system, I did an update to setup instructions this time.</p> <p>For the virtual machine, we will use <em>Qemu/KVM</em> with <em>Ovmf</em> EFI bios.</p> <p>First, Install Windows directly on your PC then reboot back to Linux. Check that <tt class="docutils literal">loop</tt> and <tt class="docutils literal">linear</tt> modules are loaded:</p> <pre class="code shell literal-block">
sudo modprobe loop
sudo modprobe linear
</pre> <p>New, we need to create a virtual RAID disk for Qemu that will hold our physical Windows partition. As we will use GPT partitions table schema, we will allocate few megabytes <tt class="docutils literal">efi1</tt> for GPT metadata (34 Sectors) and for EFI partition before Windows partition and one megabyte <tt class="docutils literal">efi2</tt> after Windows partition for GPT secondary metadata (even we need just 34 Sectors, we will use one megabyte for best RAID performance)</p> <pre class="code shell literal-block">
dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>efi1 <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">count</span><span class="o">=</span><span class="m">100</span>
dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>efi2 <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">count</span><span class="o">=</span><span class="m">1</span>
</pre> <p>Now that we have <tt class="docutils literal">efi1</tt> file of 100 MB (100 * 1M) and <tt class="docutils literal">efi2</tt> of 1 MB. Next, we create a loopback devices from both files:</p> <pre class="code shell literal-block">
sudo losetup -f efi1
sudo losetup -f efi2
</pre> <p>We will assume that the assigned devices are <tt class="docutils literal">/dev/loop0</tt> and <tt class="docutils literal">/dev/loop1</tt> for <tt class="docutils literal">efi1</tt> and <tt class="docutils literal">efi2</tt> respectively. To check the assigned devices, type:</p> <pre class="code shell literal-block">
losetup -a
</pre> <p>Next, we will merge the loopback devices and the real Windows partition into a single linear RAID disk image (We will assume that the windows partition is <tt class="docutils literal">/dev/sda2</tt>):</p> <pre class="code shell literal-block">
sudo mdadm --build --verbose /dev/md0 --chunk<span class="o">=</span><span class="m">512</span> --level<span class="o">=</span>linear --raid-devices<span class="o">=</span><span class="m">3</span> /dev/loop0 /dev/sda2 /dev/loop1
</pre> <p>Time to create the partitions table of the new RAID disk reusing the same physical Windows partition. For this step, we will use <em>parted</em> utility. You can use other tool of your choose.</p> <p>Partition your virtual RAID disk:</p> <pre class="code shell literal-block">
sudo parted /dev/md0
<span class="o">(</span>parted<span class="o">)</span> unit s
<span class="o">(</span>parted<span class="o">)</span> mktable gpt
<span class="o">(</span>parted<span class="o">)</span> mkpart primary fat32 <span class="m">2048</span> <span class="m">204799</span>    <span class="c1"># depends on size of efi1 file
</span><span class="o">(</span>parted<span class="o">)</span> mkpart primary ntfs <span class="m">204800</span> -2049    <span class="c1"># depends on size of efi1 and efi2 files
</span><span class="o">(</span>parted<span class="o">)</span> <span class="nb">set</span> <span class="m">1</span> boot on
<span class="o">(</span>parted<span class="o">)</span> <span class="nb">set</span> <span class="m">1</span> esp on
<span class="o">(</span>parted<span class="o">)</span> <span class="nb">set</span> <span class="m">2</span> msftdata on
<span class="o">(</span>parted<span class="o">)</span> name <span class="m">1</span> EFI
<span class="o">(</span>parted<span class="o">)</span> name <span class="m">2</span> Windows
<span class="o">(</span>parted<span class="o">)</span> quit
</pre> <p>Your final layout will have 2 partitions; Windows partition <tt class="docutils literal">/dev/md0p2</tt> and EFI partition <tt class="docutils literal">/dev/md0p1</tt>. The EFI partition need to be formatted.</p> <pre class="code shell literal-block">
sudo mkfs.msdos -F <span class="m">32</span> -n EFI /dev/md0p1
</pre> <p>Now let add Windows boot entry to the virtual RAID disk.</p> <p>Boot to Windows live DVD from inside Qemu virtual machine with <tt class="docutils literal">/dev/md0</tt> as disk after changing <tt class="docutils literal">/dev/md0</tt> owner to the current user and installing <em>Ovmf</em> EFI bios, which in my case, it is available at <tt class="docutils literal">/usr/share/ovmf/ovmf_x64.bin</tt>.</p> <pre class="code shell literal-block">
chown <span class="nv">$USER</span>:<span class="nv">$USER</span> /dev/md0  <span class="c1"># We need to change the owner of md0
</span>qemu-system-x86_64 <span class="se">\
</span>    -bios /usr/share/ovmf/ovmf_x64.bin <span class="se">\
</span>    -drive <span class="nv">file</span><span class="o">=</span>/dev/md0,media<span class="o">=</span>disk,format<span class="o">=</span>raw <span class="se">\
</span>    -cpu host -enable-kvm -m 2G <span class="se">\
</span>    -cdrom /path/to/windows.iso
</pre> <p>Press <tt class="docutils literal">Shift+F10</tt> when Windows installer starts to open the terminal. We need to assign letter to EFI volume (partition).</p> <pre class="code batch literal-block">
diskpart
DISKPART<span class="p">&gt;</span> list disk
DISKPART<span class="p">&gt;</span> select disk 0    # Select the disk
DISKPART<span class="p">&gt;</span> list volume      # Find EFI volume (partition) number
DISKPART<span class="p">&gt;</span> select volume 2  # Select EFI volume
DISKPART<span class="p">&gt;</span> assign letter=B  # Assign B: to EFI volume
DISKPART<span class="p">&gt;</span> exit
</pre> <p>Finally, we create BCD boot entry for Windows partition on the same terminal.</p> <pre class="code batch literal-block">
bcdboot C:\Windows /s B: /f ALL
</pre> <p>Now, you are ready to boot to Windows from inside Qemu.</p> <pre class="code shell literal-block">
qemu-system-x86_64 <span class="se">\
</span>    -bios /usr/share/ovmf/ovmf_x64.bin <span class="se">\
</span>    -drive <span class="nv">file</span><span class="o">=</span>/dev/md0,media<span class="o">=</span>disk,format<span class="o">=</span>raw <span class="se">\
</span>    -cpu host -enable-kvm -m 2G
</pre> <p>After each Linux system reboot, you need to create the loopback devices, merge the partitions into the RAID disk and change the owner of the device before launching the virtual machine. You can find <a class="reference external" href="https://github.com/lejenome/dotfiles/blob/master/bin/ws">the script I use</a> as reference.</p> <p>Credit to <a class="reference external" href="https://wiki.archlinux.org/index.php/QEMU#Simulate_virtual_disk_with_MBR_using_linear_RAID">Arch Linux Wiki</a>. Enjoy!</p> </div> </article><article class="post" id="slack-feedback-form" itemscope itemType="http://schema.org/TechArticle" itemid="https://lejenome.github.io/post/slack-feedback-form"> <meta itemprop="proficiencyLevel" content="Beginner"> <link itemprop="publisher" href="https://lejenome.github.io/resume" rel="author"> <hgroup> <h2 class="post-title" itemprop="name" itemprop="headline"><a href="post/slack-feedback-form" class="post-link" itemprop="url">Simple feedback form implementation for static websites</a></h2> <h3 class="post-date"> <time datetime="2016/10/05" itemprop="datePublished">Wed Oct 05 2016</time> - <a href="https://github.com/lejenome/lejenome.github.io/blob/master/posts/simple-feedback-form-for-static-websites.rst" rel="edit"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> edit</a> </h3> </hgroup> <div class="post-body" itemprop="articleBody"> <p>Recently, I wanted to add a feedback form to my resume page to help my friends review it. I was using GitHub pages to host my static web site and I didn't want to host the server side of the feedback on a different server. So I was looking for a simple solution that works well with my static website. Most of the available ones were either paid or have too many unneeded features.</p> <p>At the end, I decided to use my <a class="reference external" href="https://slack.com/">Slack</a> team to receive feedbacks. It does not require any third-party library or any server side code. And it's very simple to implement:</p> <ol class="arabic simple"> <li>Create a Slack team if you don't have one.</li> <li>Add an <a class="reference external" href="https://api.slack.com/incoming-webhooks">Incoming Webhook</a> URL to a channel on your team. It's a simple URL that you can send feedbacks to.</li> <li>Finally, add your client side implementation. This is a simple one:</li> </ol> <pre class="code html literal-block">
<span class="ln">1 </span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;feedback&quot;</span><span class="p">&gt;</span>
<span class="ln">2 </span>    <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">required</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
<span class="ln">3 </span>    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;send feedback&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">input</span><span class="p">&gt;</span>
<span class="ln">4 </span><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre> <pre class="code javascript literal-block">
<span class="ln"> 1 </span><span class="kd">let</span> <span class="nx">form</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;feedback&quot;</span><span class="p">);</span>
<span class="ln"> 2 </span><span class="nx">form</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;submit&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
<span class="ln"> 3 </span>    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="ln"> 4 </span>    <span class="nx">fetch</span><span class="p">(</span><span class="nx">YOUR_WEBHOOK_URL</span><span class="p">,</span> <span class="p">{</span>
<span class="ln"> 5 </span>        <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="c1">// You should use POST method
</span><span class="ln"> 6 </span><span class="c1"></span>        <span class="nx">body</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<span class="ln"> 7 </span>            <span class="nx">text</span><span class="o">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="c1">// the feedback message
</span><span class="ln"> 8 </span><span class="c1"></span>            <span class="nx">parse</span><span class="o">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="c1">// tell Slack it's not a formated text
</span><span class="ln"> 9 </span><span class="c1"></span>        <span class="p">});</span>
<span class="ln">10 </span>    <span class="p">});</span>
<span class="ln">11 </span><span class="p">});</span>
</pre> <div class="section" id="improvements"> <h1>Improvements:</h1> <p>You can add more entries to the send JSON. Check Slack <a class="reference external" href="https://api.slack.com/methods/chat.postMessage">documentation</a> for more details. The most useful ones are <tt class="docutils literal">username</tt> and <tt class="docutils literal">icon_emoji</tt>.</p> <p>You can set different a <tt class="docutils literal">username</tt> and different a <tt class="docutils literal">icon_emoji</tt> entry for every page. For example, you send this JSON from your resume page:</p> <pre class="code json literal-block">
<span class="ln">1 </span><span class="p">{</span>
<span class="ln">2 </span>    <span class="nt">&quot;text&quot;</span>       <span class="p">:</span> <span class="s2">&quot;THE FEEDBACK MESSAGE&quot;</span><span class="p">,</span>
<span class="ln">3 </span>    <span class="nt">&quot;parse&quot;</span>      <span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
<span class="ln">4 </span>    <span class="nt">&quot;username&quot;</span>   <span class="p">:</span> <span class="s2">&quot;resume&quot;</span><span class="p">,</span>
<span class="ln">5 </span>    <span class="nt">&quot;icon_emoji&quot;</span> <span class="p">:</span> <span class="s2">&quot;:briefcase:&quot;</span>
<span class="ln">6 </span><span class="p">}</span>
</pre> </div> </div> </article><article class="post" id="useful-links" itemscope itemType="http://schema.org/TechArticle" itemid="https://lejenome.github.io/post/useful-links"> <meta itemprop="proficiencyLevel" content="Beginner"> <link itemprop="publisher" href="https://lejenome.github.io/resume" rel="author"> <hgroup> <h2 class="post-title" itemprop="name" itemprop="headline"><a href="post/useful-links" class="post-link" itemprop="url">[MTCFSS] Recommendations For IT Students</a></h2> <h3 class="post-date"> <time datetime="2016/10/04" itemprop="datePublished">Tue Oct 04 2016</time> - <a href="https://github.com/lejenome/lejenome.github.io/blob/master/posts/recommandation-for-it-student.rst" rel="edit"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> edit</a> </h3> </hgroup> <div class="post-body" itemprop="articleBody"> <p>This is a list of useful websites and tools to check for Computer Science students.</p> <div class="section" id="challenges"> <h1>Challenges:</h1> <div class="section" id="algorithms-and-programming"> <h2>Algorithms and Programming</h2> <ul class="simple"> <li><a class="reference external" href="https://www.hackerrank.com/">HackerRank</a>: Different-level exercises for many domains and challenges.</li> <li><a class="reference external" href="https://projecteuler.net/">Project Euler</a>: Algorithms challenges, you can find them on <a class="reference external" href="https://www.hackerrank.com/projecteuler">ProjectEuler+</a> challenge on HackerRank too.</li> </ul> </div> <div class="section" id="system-development-and-administration"> <h2>System development and administration</h2> <ul class="simple"> <li><a class="reference external" href="http://eudyptula-challenge.org/">The Eudyptula Challenge</a>: Series of programming exercises for Linux kernel development.</li> </ul> </div> <div class="section" id="other"> <h2>Other</h2> <ul class="simple"> <li><a class="reference external" href="http://devpost.com/hackathons">DevPost</a>: Online and in-person challenges with prizes to win.</li> </ul> </div> </div> <div class="section" id="tutorials"> <h1>Tutorials:</h1> <ul class="simple"> <li><a class="reference external" href="http://www.developpez.com">Developpez.com</a>: Club des d√©veloppeurs et IT pro.</li> </ul> </div> <div class="section" id="e-learning"> <h1>E-learning:</h1> <ul class="simple"> <li><a class="reference external" href="https://www.coursera.org/">Coursera</a></li> <li><a class="reference external" href="https://www.edx.org">Edx</a></li> <li><a class="reference external" href="https://www.codecademy.com/">Codecademy</a></li> <li><a class="reference external" href="https://www.udacity.com/">Udacity</a></li> <li><a class="reference external" href="https://lagunita.stanford.edu/">Stanford Online Lagunita</a></li> <li><a class="reference external" href="http://ocw.mit.edu/">MIT OpenCourseWare</a></li> </ul> </div> <div class="section" id="usefull-tools"> <h1>Usefull tools:</h1> <ul class="simple"> <li><a class="reference external" href="https://github.com">GitHub</a>: #1 Online project hosting service.</li> <li><a class="reference external" href="https://c9.io/">Could9</a>: Full-featured development environment, in the cloud.</li> <li><a class="reference external" href="https://zealdocs.org/">Zeal</a>: offline documentation for 195+ programming languages and APIs.</li> <li><a class="reference external" href="http://devdocs.io/">DevDocs</a>: Online APIs documentation.</li> </ul> </div> <div class="section" id="freelancer-money"> <h1>Freelancer &amp; Money:</h1> <ul class="simple"> <li><a class="reference external" href="https://www.topcoder.com">TopCoder</a></li> <li><a class="reference external" href="https://www.upwork.com/">UpWork</a></li> <li><a class="reference external" href="https://www.freelancer.com/">Freelancer</a></li> </ul> </div> <div class="section" id="cv"> <h1>CV:</h1> <ul class="simple"> <li><a class="reference external" href="https://www.linkedin.com/">LinkedIn</a></li> <li><a class="reference external" href="https://stackoverflow.com/story">StackOverFlow Story</a></li> </ul> </div> </div> </article><article class="post" id="dualboolt-guest-window-machine" itemscope itemType="http://schema.org/TechArticle" itemid="https://lejenome.github.io/post/dualboolt-guest-window-machine"> <meta itemprop="proficiencyLevel" content="Beginner"> <link itemprop="publisher" href="https://lejenome.github.io/resume" rel="author"> <hgroup> <h2 class="post-title" itemprop="name" itemprop="headline"><a href="post/dualboolt-guest-window-machine" class="post-link" itemprop="url">Physical boot to virtual EFI Windows machine</a></h2> <h3 class="post-date"> <time datetime="2016/09/15" itemprop="datePublished">Thu Sep 15 2016</time> - <a href="https://github.com/lejenome/lejenome.github.io/blob/master/posts/dual-boot-to-virtual-machine.rst" rel="edit"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> edit</a> </h3> </hgroup> <div class="post-body" itemprop="articleBody"> <p><strong>Update:</strong> A new version of the articale with better solution is available <a class="reference external" href="/post/boot-physical-windows-inside-qemu-guest-machine">here</a>.</p> <p>Even Linux is my main system, I frequently need to use Windows for school homework when Mono does not support desired features. Running Windows inside a virtual machine is always enough expect few cases. The best solution was to setup a single windows system accessible from both the virtual machine and from the physical dual boot.</p> <p>For the virtual machine, we will use <em>Qemu/KVM</em> with <em>Virtio</em> devices and a disk partition for Windows.</p> <p>First, you need to install Windows on your PC to get the boot entry with right configurations (I couldn't find a work around BCD boot entry issue other than this one). Then reboot to your Linux system to reinstall Windows on the same partition but using the virtual machine this time.</p> <p>Before we start, check that <tt class="docutils literal">loop</tt> and <tt class="docutils literal">linear</tt> modules are loaded:</p> <pre class="code shell literal-block">
sudo modprobe loop
sudo modprobe linear
</pre> <p>Because the virtual machine need whole disk with both the Windows partition and the EFI partition, We need to create a virtual RAID. Let's create a small file to hold the EFI partition:</p> <pre class="code shell literal-block">
dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>efi <span class="nv">count</span><span class="o">=</span><span class="m">200000</span>
</pre> <p>Now you have <tt class="docutils literal">efi</tt> file of 100 MB (200000 * 512 Bytes). Next, we create a loopback device from the file:</p> <pre class="code shell literal-block">
sudo losetup -f efi
</pre> <p>It will assign the first available loopback device to the file. We will assume that the assigned device is <tt class="docutils literal">/dev/loop0</tt>. To check the assigned device:</p> <pre class="code shell literal-block">
losetup -a
</pre> <p>Next, we will merge the loopback device and the real Windows partition into a single linear RAID disk image (We will assume that the windows partition is <tt class="docutils literal">/dev/sda2</tt>):</p> <pre class="code shell literal-block">
sudo mdadm --build --verbose /dev/md0 --chunk<span class="o">=</span><span class="m">16</span> --level<span class="o">=</span>linear --raid-devices<span class="o">=</span><span class="m">2</span> /dev/loop0 /dev/sda2
</pre> <p>Time to create the partitions table of the new RAID disk with reusing the same physical Windows partition. For this step, we will use _parted_ utility. You can use other tools on your own. We need to get the size of real Windows partition on sectors.</p> <pre class="code shell literal-block">
sudo parted /dev/sda unit s print
</pre> <p>Partition your virtual RAID disk:</p> <pre class="code shell literal-block">
sudo parted /dev/md0
<span class="o">(</span>parted<span class="o">)</span> unit s
<span class="o">(</span>parted<span class="o">)</span> mktable gpt
<span class="o">(</span>parted<span class="o">)</span> mkpart primary ntfs -WINDOW_PARITION_SIZE -1
<span class="o">(</span>parted<span class="o">)</span> mkpart primary fat32 <span class="m">0</span> -WINDOW_PARITION_SIZE
<span class="o">(</span>parted<span class="o">)</span> quit
</pre> <p>Your final layout will have 2 partitions; Windows partition <tt class="docutils literal">/dev/md0p1</tt> and EFI partition <tt class="docutils literal">/dev/md0p2</tt>. You may get few warning messages when creating partitions, ignore them. The new partitions need to be formatted.</p> <pre class="code shell literal-block">
sudo mkfs.ntfs -f -L Windows -C /dev/md0p1
sudo mkfs.msdos -F <span class="m">32</span> -n EFI /dev/md0p2
</pre> <p>Now, you are ready to launch the virtual machine and reinstall Windows. Change <tt class="docutils literal">/dev/md0</tt> owner to the same user _Qemu_ is running as and install _ovmf_ EFI bios for _Qemu_, in my case, it will be available at <tt class="docutils literal">/usr/share/ovmf/ovmf_x64.bin</tt>.</p> <pre class="code shell literal-block">
qemu-system-x86_64 <span class="se">\
</span>    -enable-kvm <span class="se">\
</span>    -bios /usr/share/ovmf/ovmf_x64.bin <span class="se">\
</span>    -drive <span class="nv">file</span><span class="o">=</span>/dev/md0,media<span class="o">=</span>disk,format<span class="o">=</span>raw <span class="se">\
</span>    -netdev user,id<span class="o">=</span>windowsnic,hostname<span class="o">=</span>windowshost <span class="se">\
</span>    -device virtio-net,netdev<span class="o">=</span>windowsnic <span class="se">\
</span>    -cpu host <span class="se">\
</span>    -m 2G <span class="se">\
</span>    -vga qxl <span class="se">\
</span>    -usbdevice tablet
</pre> <p>Adapt _Qemu_ script to your use case. You may need to download and install <a class="reference external" href="https://fedoraproject.org/wiki/Windows_Virtio_Drivers">Virtio drivers</a> on your guest machine. After each reboot, you need to create the loopback device, merge the two partitions into the RAID disk and change the owner of the device.</p> <p>Credit to <a class="reference external" href="https://wiki.archlinux.org/index.php/QEMU#Simulate_virtual_disk_with_MBR_using_linear_RAID">Arch Linux Wiki</a>. Enjoy!</p> </div> </article> </section> <nav id="posts-nav"> <ul> <li><a href="page/2" rel="prev" id="next-post">Older</a></li> </ul> </nav> </div> <script>function linenumber(n){var l;for(l=0;l<n.length;l++){var e=n[l].innerHTML;e='<ol class="linenums"><li><span class="codeline">'+e.split("\n").slice(0,-1).join('</span></li><li><span class="codeline">')+"</span></li></ol>",n[l].innerHTML=e}}linenumber(document.querySelectorAll(".code pre"))</script> <noscript id="deferred-styles"> <link rel="stylesheet" type="text/css" href="css/font-awesome.css"> <link rel="stylesheet" type="text/css" href="css/source-code-pro.css"> <link rel="stylesheet" type="text/css" href="css/pygmentize.default.css"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i,900,900i"> </noscript> <script>var loadDeferredStyles=function(){var e=document.getElementById("deferred-styles"),t=document.createElement("div");t.innerHTML=e.textContent,document.body.appendChild(t),e.parentElement.removeChild(e)},raf=requestAnimationFrame||mozRequestAnimationFrame||webkitRequestAnimationFrame||msRequestAnimationFrame;raf?raf(function(){window.setTimeout(loadDeferredStyles,0)}):window.addEventListener("load",loadDeferredStyles)</script> <script type="text/javascript">var _paq=_paq||[];_paq.push(["enableHeartBeatTimer"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var e="https://api.admin.tik.tn/p";_paq.push(["setTrackerUrl",e]),_paq.push(["setSiteId",1]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.defer=!0,t.src=e,p.parentNode.insertBefore(t,p)}()</script> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-2482029926365022",enable_page_level_ads:!0})</script> </body> </html>